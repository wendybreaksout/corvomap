jQuery(document).ready(function(e){e(".gst-sortable").sortable();e(".gst-sortable").disableSelection();j();g();e(".gst_date_input").datepicker({dateFormat:"M dd"});e(".gst_proposal_input").on("change",function(){e(this).attr("value",e(this).val())});e("#meta_proposal_list").on("sortupdate",function(o,p){k(o,e(this))});e(".gst-sort-edit-delete").click(function(o){e(this).parent().parent().remove()});e("#meta_proposal_list .gst-sort-edit-delete").click(function(o){e(this).parent().parent().remove();k(o,e(this))});e("#post").submit(function(){});e(".gst_date_input").change(function(){g()});var c;e(".gst-sort-edit-image-upload").click(function(o){n(o,e(this))});e(".gst-sort-edit-image-add").click(function(p){var o=atob(e(this).siblings(".gst_clone_template").val());e(this).parent().parent().children().filter(".gst-sortable").append(o);e(this).parent().parent().children().filter(".gst-sortable").children().last().find(".gst-sort-edit-delete").click(function(){e(this).parent().parent().remove()});e(this).parent().parent().children().filter(".gst-sortable").children().last().find(".gst-sort-edit-image-upload").click(function(){n(p,e(this))});e(this).parent().parent().children().filter(".gst-sortable").children().last().find(".gst_clear_input_target").val("");e(this).parent().parent().children().filter(".gst-sortable").children().last().find(".gst-sort-edit-image-upload").trigger("click")});e(".gst-sort-edit-add").click(function(){var o=atob(e(this).siblings(".gst_clone_template").val());e(this).parent().parent().children().filter(".gst-sortable").append(o);e(this).parent().parent().children().filter(".gst-sortable").children().last().find("input").attr("value","");e(this).parent().parent().children().filter(".gst-sortable").children().last().find(".gst-sort-edit-delete").click(function(){e(this).parent().parent().remove()})});e(".gst-sort-edit-proposal-add").click(function(p){var o=atob(e(this).siblings(".gst_clone_template").val());e(this).parent().parent().children().filter(".gst-sortable").append(o);e(this).parent().parent().children().filter(".gst-sortable").children().last().find("input").attr("value","");k(p,e(this))});e(".option-tree-setting-body").append('<a class="ot_setting_body_done">Done</a>');d(e("#meta_map_amenity_select").val());f(e("#meta_map_proposal_select").val());e("#meta_map_amenity_select").change(function(){d(this.value)});e("#meta_map_proposal_select").change(function(){f(this.value)});e(".ot_setting_body_done").click(function(){e('.option-tree-setting-body[style="display: block;"]').css("display","none")});e(".option-tree-list-item-add").click(function(){setTimeout(function(){e('.option-tree-setting-body[style="display: block;"]').append('<a class="ot_setting_body_done">Done</a>');e('.option-tree-setting-body[style="display: block;"] .ot_setting_body_done').click(function(){e('.option-tree-setting-body[style="display: block;"]').css("display","none")})},500)});function j(){e.ajax({url:cmp_admin_objectl10n.wpsiteinfo.site_url+"/wp-admin/admin-ajax.php",data:{action:"crowdmap_ajax",fn:"get_post_edit_options"},dataType:"JSON",success:function(p){if(p.errorData!=null&&p.errorData=="true"){m(p)}var o=p;e(".gst_countable").simplyCountable({counter:"#gst_counter",countType:"characters",maxCount:o.map_excerpt_max_char_count,strictMax:false,overClass:"gst-excerpt-over",countDirection:"down"})},error:function(o){console.log(o)}})}function d(o){if(o!=null&&o!=""){e.ajax({url:cmp_admin_objectl10n.wpsiteinfo.site_url+"/wp-admin/admin-ajax.php",data:{action:"crowdmap_ajax",fn:"get_amenity_set_list",postID:o},dataType:"JSON",success:function(p){if(p.errorData!=null&&p.errorData=="true"){m(p)}a(p)},error:function(p){console.log(p)}})}else{a("")}}function a(q){var p=".adm_amenity_set_list";var o="#amenity_list_panel";e(p).empty();if(q==""){e(p).append("<p>"+cmp_admin_objectl10n.note_no_amnenity_set_selected+"</p>");return}e(p).append('<div id="'+o+'">');e(p).append("<ul>");for(i in q){e(p).append("<li>"+q[i]+"</li>")}e(p).append("</ul>");e(p).append("</div>")}function f(o){if(o!=null&&o!=""){e.ajax({url:cmp_admin_objectl10n.wpsiteinfo.site_url+"/wp-admin/admin-ajax.php",data:{action:"crowdmap_ajax",fn:"get_proposal",postID:o},dataType:"JSON",success:function(p){if(p.errorData!=null&&p.errorData=="true"){m(p)}l(p)},error:function(p){alert(cmp_admin_objectl10n.get_proposal_error+p.responseText.substring(0,500));console.log(p)}})}else{l("")}}function l(p){var q=".adm_proposal";var o="proposal_panel";e(q).empty();if(p==""){e(q).append("<p>"+cmp_admin_objectl10n.note_no_proposal_selected+"</p>");return}var r='<div id="'+o+'">';r+='<ul id="proposal">';for(i in p){r+="<li><h3>"+p[i].title+"</h3>";if(p[i].dateRange1!=""){r+="<h4>"+p[i].dateRange1+"</h4>"}priceStr="<table><tr>";priceStr+="<th>"+cmp_admin_objectl10n.sunday+"</th>";priceStr+="<th>"+cmp_admin_objectl10n.monday+"</th>";priceStr+="<th>"+cmp_admin_objectl10n.tuesday+"</th>";priceStr+="<th>"+cmp_admin_objectl10n.wednesday+"</th>";priceStr+="<th>"+cmp_admin_objectl10n.thursday+"</th>";priceStr+="<th>"+cmp_admin_objectl10n.friday+"</th>";priceStr+="<th>"+cmp_admin_objectl10n.saturday+"</th>";priceStr+="</tr><tr>";priceStr+="<td>"+p[i].priceByDOW.sunday+"</td>";priceStr+="<td>"+p[i].priceByDOW.monday+"</td>";priceStr+="<td>"+p[i].priceByDOW.tuesday+"</td>";priceStr+="<td>"+p[i].priceByDOW.wednesday+"</td>";priceStr+="<td>"+p[i].priceByDOW.thursday+"</td>";priceStr+="<td>"+p[i].priceByDOW.friday+"</td>";priceStr+="<td>"+p[i].priceByDOW.saturday+"</td>";priceStr+="</tr>";priceStr+="</table>";r+='<div class="cmp_map_price">'+priceStr+"</div></li>"}r+="</ul>";r+="</div>";e(q).append(r)}function n(p,o){p.preventDefault();o.siblings(".gst_image_url_target").addClass("gst-set-media-target");o.siblings("a").children("img").addClass("gst-set-media-thumbnail-target");c=wp.media.frames.meta_image_frame=wp.media({library:{type:"image"}});c.on("select",function(){var q=c.state().get("selection").first().toJSON();e(".gst-set-media-target").val(q.url);e(".gst-set-media-target").removeClass("gst-set-media-target");e(".gst-set-media-thumbnail-target").attr("src",q.url);e(".gst-set-media-thumbnail-target").removeClass("gst-set-media-thumbnail-target")});c.open()}function k(p,o){e("#meta_proposal_list").children().each(function(q,t){var s=e(t).html();var r="meta_proposal_list["+q+"]";var u=s.replace(/meta_proposal_list\[[0-9]*\]/g,r);u='<li class="ui-state-default">'+u+"</li>";e(this).replaceWith(u)});e(".gst_date_input").removeClass("hasDatepicker");e(".gst_date_input").attr("id","");e(".gst_date_input").datepicker({dateFormat:"M dd"});e(".gst_proposal_input").on("change",function(){e(this).attr("value",e(this).val())});e(".gst_date_input").change(function(){g()});e("#meta_proposal_list .gst-sort-edit-delete").click(function(){e(this).parent().parent().remove();k(p,e(this))})}function g(){var o=e(".gst_date_input");coveredRanges=new Array();var r="";for(var p=0;p<o.length;p=p+2){r=r+" "+o[p].value+" "+o[p+1].value;startStr=o[p].value;endStr=o[p+1].value;now=new Date();startDate=new Date(startStr+", "+now.getFullYear());endDate=new Date(endStr+", "+now.getFullYear());startLongTime=Date.UTC(now.getFullYear(),startDate.getMonth(),startDate.getDate());endLongTime=Date.UTC(now.getFullYear(),endDate.getMonth(),endDate.getDate());janOneLongTime=Date.UTC(now.getFullYear(),0,1);startDOY=(startLongTime-janOneLongTime)/86400000;endDOY=(endLongTime-janOneLongTime)/86400000;if(o.length==2&&(isNaN(startDOY)||isNaN(endDOY))){startDOY=0;endDOY=365}if(endDOY<startDOY){range1={min:0,max:endDOY};range2={min:startDOY,max:365};coveredRanges.push(range1);coveredRanges.push(range2)}else{range1={min:startDOY,max:endDOY};coveredRanges.push(range1)}}coveredRanges.sort(function(u,t){return u.min-t.min});overlaps=new Array();gaps=new Array();if(coveredRanges.length==1){if(coveredRanges[0].min>0){gaps.push({min:1,max:coveredRanges[0].min})}if(coveredRanges[0].max<364){gaps.push({min:coveredRanges[0].max+2,max:365})}}else{for(p=0;p<coveredRanges.length;p++){thisIdx=p;nextIdx=(p+1==coveredRanges.length?0:p+1);if(nextIdx==0){rangeCmp=coveredRanges[p].max-364;if(rangeCmp==0||rangeCmp==1){}else{gaps.push({min:coveredRanges[p].max+2,max:365})}}else{rangeCmp=coveredRanges[nextIdx].min-coveredRanges[p].max;if(p==0){if(coveredRanges[p].min==0){}else{gaps.push({min:1,max:coveredRanges[p].min})}}if(rangeCmp==1||rangeCmp==-364){}else{if(rangeCmp==0){overlaps.push({min:coveredRanges[p].max+1,max:coveredRanges[p].max+1})}else{if(rangeCmp>1){gaps.push({min:coveredRanges[p].max+2,max:coveredRanges[nextIdx].min})}else{if(rangeCmp<0){overlaps.push({min:coveredRanges[nextIdx].min+1,max:coveredRanges[p].max+1})}}}}}}}var s=cmp_admin_objectl10n.gaps_msg+" ";for(p=0;p<gaps.length;p++){min_lt=gaps[p].min*86400000+janOneLongTime;max_lt=gaps[p].max*86400000+janOneLongTime;minDate=new Date(min_lt);maxDate=new Date(max_lt);s+=b(minDate.getMonth())+" "+minDate.getDate()+"-";s+=b(maxDate.getMonth())+" "+maxDate.getDate()+"  "}var q=cmp_admin_objectl10n.overlaps_msg+" ";for(p=0;p<overlaps.length;p++){min_lt=overlaps[p].min*86400000+janOneLongTime;max_lt=overlaps[p].max*86400000+janOneLongTime;minDate=new Date(min_lt);maxDate=new Date(max_lt);q+=b(minDate.getMonth())+" "+minDate.getDate()+"-";q+=b(maxDate.getMonth())+" "+maxDate.getDate()+"  "}if(overlaps.length>0||gaps.length>0){e(".meta_proposal_list_feedback").html("<p>"+q+"</br>"+s+"</p>")}else{e(".meta_proposal_list_feedback").empty()}}function b(o){switch(o){case 0:return cmp_admin_objectl10n.jan;case 1:return cmp_admin_objectl10n.feb;case 2:return cmp_admin_objectl10n.mar;case 3:return cmp_admin_objectl10n.apr;case 4:return cmp_admin_objectl10n.may;case 5:return cmp_admin_objectl10n.jun;case 6:return cmp_admin_objectl10n.jul;case 7:return cmp_admin_objectl10n.aug;case 8:return cmp_admin_objectl10n.sep;case 9:return cmp_admin_objectl10n.oct;case 10:return cmp_admin_objectl10n.nov;case 11:return cmp_admin_objectl10n.dec;default:console.log("Unexpected month number value"+o)}return cmp_admin_objectl10n.jan}function h(p,o){alert("test function")}function m(o){console.log(o)}});